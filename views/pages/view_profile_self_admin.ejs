<!DOCTYPE html>
<html lang="en">
<head>
    <%- include ("../partials/head.ejs") %>

    <title>Mnemosis | Profile</title>
    <link rel="stylesheet" href="../../css/view_profile.css">
</head>
<body>
    <%- include ("../partials/header.ejs") %>
    <div class="grid card heading mt-5 mb-5" style="padding-top: 10px; padding-bottom: 10px; ">
        <div class="prof_title ">My Profile</div>
        <div class="prof_pic"><img src="'../../'+ '<%= details.user.user_image %>'" height="180px" width="180px"></div>
        <div class="prof_hemail">Email:</div>
        <div class="prof_hage">Birthday:</div>
        <div class="prof_hgender">Gender:</div>
        <div class="prof_email subheading"><%= details.user.email %></div>
        <div class="prof_age subheading">
            <%var age = 2020 -  details.user.birthday.getYear()%>
            <%= details.user.birthday%></div>
        <div class="prof_gender subheading"><%= details.user.gender %></div>
        <div class="prof_text1 ">Total Games Created</div>
        <div class="prof_text2 ">Total Games Completed</div>
        <div class="prof_subtext1 subheading">
            
            <%var created=0%> 
            <% details.games.forEach(function (game) { %>
                <% if (game.creator.equals(details.user._id)){%>
                    <%created= created +1 %>
                <%}%>
            <% }) %>
            <%= created %></div>
        <div class="prof_subtext2 subheading">
            <%var completed = 0%>
            <% details.games.forEach(function (game) { %>
                <% details.attempts.forEach(function (attempt) { %>
                    <% if (game._id.equals(attempt.game_id)){%>
                        <% var count = 0 %>
                        <% details.items.forEach(function (item) { %>
                            <% if (item.game_id.equals(game._id))%>
                                <%count = count+1 %>
                        <% }) %>
                        <% if (attempt.answered == count){%>
                            <%completed = completed +1%>
                        <%}%>
                    <%}%>
                <% }) %>
            <% }) %>
            <%= completed%>
        </div>
        <div class="prof_name "><%= details.user.name %></div>
        <div class="input-group mb-3 prof_file">
            <div class="input-group-prepend">
              <button class="btn btn-outline-secondary btn-custom" type="button" id="upload">Upload</button>
            </div>
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="file" aria-describedby="upload">
              <label class=" custom-file-label" for="file">Choose file</label>
            </div>
        </div>
    </div>

    <div class="container mt-5 mb-5" id="1-main-box">
        <button type="button" class="btn btn-custom btn-block" id="admin">Drop Admin Status</button>
        <a href="/create_game" class="btn btn-custom btn-block mb-5" id="create">Create Game</a>
        <h2 class="heading" style="text-align: center"><%= details.user.name %>'s Games</h2>
        <div class="row">
            <% details.games.forEach(function (game) { %>
                <% if (game.creator.equals(details.user._id)){%>
                    <div class="col-sm-4 mb-4">
                        <div class="card
                            <% for (let i = 0; i < game.genres.length; i++ ) { %>
                            <%= 'card-' + game.genres[i] %>
                            <% } %>" >

                            <div class="card-header pt-2 pb-1">
                                <div class="container row m-0" style="height:15px;">
                                    <% var len = game.genres.length %>
                                    <% for (i = 0; i < len; i++ ) { %>
                                        <div class="col border <%= 'bg-' + game.genres[i] %>
                                            <% if (i < len - 1) { %>
                                            <%= 'mr-1' %>
                                            <% } %>">
                                        </div>
                                    <% } %>
                                </div>
                            </div>

                            <img class="card-img-top card-img-custom" src="<%= game.image %>">

                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title heading"><%= game.title %></h5>
                                <p class="card-text subheading" style="display: none"><%= game.description %></p>
                                <div class="mt-auto">
                                    <button type="button" class="btn btn-custom btn-block" data-toggle="modal" data-target="#playModal">Play Game</button>
                                    <a href="/modify_game" class="btn btn-custom btn-block">Modify Game</a>
                                    <button type="button" class="btn btn-custom2 btn-block" data-toggle="modal" data-target="#deleteModal">Delete Game</button>
                                </div>
                            </div>
    
                            <div class="card-footer">
                                <p id="game_id" style="display: none"><%= game._id %></p>
                                <small id="author" class="text-muted subheading">Created by <a href="/view_profile"><%= game.creator %></a></small>
                            </div>
                        </div>
                    </div>
                <%}%>
            <% }) %>
                
        </div>
        <button type="button" class="btn btn-custom btn-block subheading" id="button">Show More</button>
    </div>


    
    <div class="container mt-5 mb-5" id="2-main-box">
        <h2 class="heading" style="text-align: center">Games Completed</h2>
        <div class="row">
            
            <% details.games.forEach(function (game) { %>
                <% details.attempts.forEach(function (attempt) { %>
                    <% if (game._id.equals(attempt.game_id)){%>
                        <% var count = 0 %>
                        <% details.items.forEach(function (item) { %>
                            <% if (item.game_id.equals( game._id))%>
                                <%count = count+1 %>
                        <% }) %>
                        <% if (attempt.answered == count){%>
                        <div class="col-sm-4 mb-4">
                            <div class="card
                                <% for (let i = 0; i < game.genres.length; i++ ) { %>
                                <%= 'card-' + game.genres[i] %>
                                <% } %>" >

                                <div class="card-header pt-2 pb-1">
                                    <div class="container row m-0" style="height:15px;">
                                        <% var len = game.genres.length %>
                                        <% for (i = 0; i < len; i++ ) { %>
                                            <div class="col border <%= 'bg-' + game.genres[i] %>
                                                <% if (i < len - 1) { %>
                                                <%= 'mr-1' %>
                                                <% } %>">
                                            </div>
                                        <% } %>
                                    </div>
                                </div>

                                <img class="card-img-top card-img-custom" src="<%= game.image %>">

                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title heading"><%= game.title %></h5>
                                    <p class="card-text subheading" style="display: none"><%= game.description %></p>
                                    <div class="mt-auto">
                                        <button type="button" class="btn btn-custom btn-block" data-toggle="modal" data-target="#playModal">Play Game</button>
                                        <a href="/modify_game" class="btn btn-custom btn-block">Modify Game</a>
                                        <button type="button" class="btn btn-custom2 btn-block" data-toggle="modal" data-target="#deleteModal">Delete Game</button>
                                    </div>
                                </div>
        
                                <div class="card-footer">
                                    <p id="game_id" style="display: none"><%= game._id %></p>
                                    <small id="author" class="text-muted subheading">Created by <a href="view_profile_self"><%= game.creator %></a></small>
                                </div>
                            </div>
                        </div>
                        <%}%>
                    <%}%>
                <% }) %>
            <% }) %>
        </div>
        <button type="button" class="btn btn-custom btn-block subheading" id="button2">Show More</button>
    </div>
    
    <%- include ("../partials/modal.ejs") %>
    <%- include ("../partials/delete_modal_profile.ejs") %>
    <%- include ("../partials/footer.ejs") %>

    <script src="../../js/view_profile.js"></script>
</body>
</html>